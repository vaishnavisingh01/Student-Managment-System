
{% extends 'base.html' %}
{% block title %}Student Records{% endblock %}
{% block header %}Student Records{% endblock %}
{% block content %}
{% load static %}

{% if messages %}
    {% for message in messages %}
        <div id="flash-message" style="
            padding: 10px;
            margin-bottom: 15px;
            color: green;
            background-color: #e6fffa;
            border: 1px solid #38b2ac;
            border-radius: 5px;
            font-weight: bold;
        ">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<!-- ===== PAGE HEADING ===== -->
 <!--
<div style="text-align:center; margin: 30px 0 20px;">
    <h1 style="
        font-size: 28px;
        font-weight: 800;
        color: #2f855a;
        margin-bottom: 5px;
    ">
        ðŸŽ“ Student Records
    </h1>
    <div style="
        width: 80px;
        height: 4px;
        background-color: #38a169;
        margin: 0 auto;
        border-radius: 2px;
    "></div>
</div>-->

<!-- ===== TOP ACTION BAR ===== -->
<div style="
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
">

    <!-- LEFT: ADD STUDENT -->
    <a href="{% url 'create_student' %}" style="
        padding: 6px 12px;
        background-color: #38a169;
        color: white;
        border-radius: 6px;
        font-weight: bold;
        font-size: 13px;
        text-decoration: none;
    ">
        âž• Add Student
    </a>

    <!-- RIGHT: SEARCH + SORT + LOGIN/LOGOUT -->
    <div style="display:flex; align-items:center; gap:8px;">

        <form method="GET"
            style="display: flex; align-items: center; gap: 6px; margin: 0;">

            <!-- SEARCH -->
            <input type="text"
                name="q"
                placeholder="Search"
                value="{{ query|default:'' }}"
                style="width:80px; height:15px; font-size:12px;">

            <!-- SORT 
            <select name="sort"
                    onchange="this.form.submit()"
                    style="height:24px; font-size:12px;">
                <option value="">Sort</option>
                <option value="name" {% if sort == 'name' %}selected{% endif %}>Name</option>
                <option value="age" {% if sort == 'age' %}selected{% endif %}>Age</option>
                <option value="joining" {% if sort == 'joining' %}selected{% endif %}>Joining</option>
                <option value="completion" {% if sort == 'completion' %}selected{% endif %}>Completion</option>
            </select>

             FILTER (TOP N) 
            <select name="limit"
                    onchange="this.form.submit()"
                    style="height:24px; font-size:12px;">
                <option value="">Filter</option>
            <option value="5" {% if limit == '5' %}selected{% endif %}>Top 5</option>
            <option value="10" {% if limit == '10' %}selected{% endif %}>Top 10</option>
            <option value="20" {% if limit == '20' %}selected{% endif %}>Top 20</option>
        </select>-->

        
    </form>

    <a href="{% url 'export_students_excel' %}?q={{ query }}&sort={{ sort }}&limit={{ limit }}"
   style="
        padding: 4px 8px;
        background-color: #3182ce;
        color: white;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        text-decoration: none;
   ">
    Excel
</a>

<a href="{% url 'export_students_pdf' %}?q={{ query }}&sort={{ sort }}&limit={{ limit }}"
   style="
        padding: 4px 8px;
        background-color: #805ad5;
        color: white;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        text-decoration: none;
   ">
    PDF
</a>

        <button onclick="printStudentTable()" class="action-btn" style="
            padding: 4px 8px;
            background-color: #4a5568;
            color: white;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            border: none;
            cursor: pointer;
        ">
     Print
</button>


        
        <!-- LOGIN / LOGOUT (SEPARATE FORM) -->
         
        {% if user.is_authenticated %}
            <form method="post" action="{% url 'logout' %}" style="margin:0;">
                {% csrf_token %}
                <button type="submit" style="
                    padding: 4px 10px;
                    background-color: #e53e3e;
                    color: white;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: bold;
                    border: none;
                    cursor: pointer;
                ">
                    Logout
                </button>
            </form>
        {% else %}
            <a href="{% url 'login' %}" style="
                padding: 4px 10px;
                background-color: #2b6cb0;
                color: white;
                border-radius: 4px;
                font-size: 12px;
                font-weight: bold;
                text-decoration: none;
            ">
                Login
            </a>
        {% endif %}
        

    </div>
</div>

<!-- ðŸ”¹ FILTER FORM (OUTSIDE TABLE) -->
<form id="filterForm" method="get">
    {% if query %}<input type="hidden" name="q" value="{{ query }}">{% endif %}
    {% if sort %}<input type="hidden" name="sort" value="{{ sort }}">{% endif %}
    {% if dir %}<input type="hidden" name="dir" value="{{ dir }}">{% endif %}
</form>

<div id="print-area">
<table>
    <thead>
        <tr>
            <!-- âœ… S.No -->
            <th style="white-space: nowrap; vertical-align: middle;">
                S.No<br>
                <select name="limit"
                        form="filterForm"
                        onchange="this.form.submit()"
                        style="font-size:11px; height:20px; margin-top:4px;">
                    <option value="">All</option>
                    <option value="5" {% if limit == '5' %}selected{% endif %}>5</option>
                    <option value="10" {% if limit == '10' %}selected{% endif %}>10</option>
                    <option value="20" {% if limit == '20' %}selected{% endif %}>20</option>
                </select>
            </th>

            <!-- âœ… Name -->
            <th>
                <a href="?sort=name&dir={% if sort == 'name' and dir == 'asc' %}desc{% else %}asc{% endif %}
                   {% if query %}&q={{ query }}{% endif %}
                   {% if limit %}&limit={{ limit }}{% endif %}"
                   style="color:white; text-decoration:none;">
                    Name
                    {% if sort == 'name' %}
                        {% if dir == 'asc' %}â†‘{% else %}â†“{% endif %}
                    {% endif %}
                </a>
            </th>

            <th>
                <a href="?sort=email&dir={% if sort == 'email' and dir == 'asc' %}desc{% else %}asc{% endif %}
                   {% if query %}&q={{ query }}{% endif %}
                   {% if limit %}&limit={{ limit }}{% endif %}"
                   style="color:white; text-decoration:none;">
                    Email
                    {% if sort == 'email' %}
                        {% if dir == 'asc' %}â†‘{% else %}â†“{% endif %}
                    {% endif %}
                </a>
            </th>
            <th>Contact</th>

            <!-- âœ… age -->
            <th>
                <a href="?sort=age&dir={% if sort == 'age' and dir == 'asc' %}desc{% else %}asc{% endif %}
                   {% if query %}&q={{ query }}{% endif %}
                   {% if limit %}&limit={{ limit }}{% endif %}"
                   style="color:white; text-decoration:none;">
                    Age
                    {% if sort == 'age' %}
                        {% if dir == 'asc' %}â†‘{% else %}â†“{% endif %}
                    {% endif %}
                </a>
            </th>


            <!-- âœ… Age Filter 
            <th>
                Age<br>
                <select name="age_filter"
                        form="filterForm"
                        onchange="this.form.submit()"
                        style="font-size:11px; width:70px; margin-top:4px;">
                    <option value="">All</option>
                    <option value="18-25">18â€“25</option>
                    <option value="26-40">26â€“40</option>
                    <option value="41-60">41â€“60</option>
                </select>
            </th>-->

            <!-- âœ… Joining -->
            <th>
                <a href="?sort=joining&dir={% if sort == 'joining' and dir == 'asc' %}desc{% else %}asc{% endif %}
                   {% if query %}&q={{ query }}{% endif %}
                   {% if limit %}&limit={{ limit }}{% endif %}"
                   style="color:white; text-decoration:none;">
                    Joining
                    {% if sort == 'joining' %}
                        {% if dir == 'asc' %}â†‘{% else %}â†“{% endif %}
                    {% endif %}
                </a>
            </th>
            <!--Intership-->
            <th>
                <a href="?sort=internship&dir={% if sort == 'internship' and dir == 'asc' %}desc{% else %}asc{% endif %}
                   {% if query %}&q={{ query }}{% endif %}
                   {% if limit %}&limit={{ limit }}{% endif %}"
                   style="color:white; text-decoration:none;">
                    Internship
                    {% if sort == 'internship' %}
                        {% if dir == 'asc' %}â†‘{% else %}â†“{% endif %}
                    {% endif %}
                </a>
            </th>

            <!-- âœ… Completion -->
            <th>
                <a href="?sort=completion&dir={% if sort == 'completion' and dir == 'asc' %}desc{% else %}asc{% endif %}
                   {% if query %}&q={{ query }}{% endif %}
                   {% if limit %}&limit={{ limit }}{% endif %}"
                   style="color:white; text-decoration:none;">
                    Completion
                    {% if sort == 'completion' %}
                        {% if dir == 'asc' %}â†‘{% else %}â†“{% endif %}
                    {% endif %}
                </a>
            </th>

            <th>Documents</th>
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>
        {% for student in students %}
        <tr>
            <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
            <td>{{ student.name }}</td>
            <td>{{ student.email }}</td>
            <td>{{ student.contact_no }}</td>
            <td>{{ student.age }}</td>
            <td>{{ student.date_of_joining }}</td>
            <td>{{ student.internship_period }} months</td>
            <td>{{ student.completion_date }}</td>

            <td>
                10th:
                {% if student.documents.marksheet_10 %}
                    <a href="{{ student.documents.marksheet_10.url }}" target="_blank">View</a>
                {% else %}
                    Not Uploaded
                {% endif %}
                <br>
                12th:
                {% if student.documents.marksheet_12 %}
                    <a href="{{ student.documents.marksheet_12.url }}" target="_blank">View</a>
                {% else %}
                    Not Uploaded
                {% endif %}
            </td>

            <td>
                <a href="{% url 'update_student' student.id %}">Edit</a> |
                <a href="{% url 'delete_student' student.id %}"
                   onclick="return confirm('Are you sure you want to delete this student?')">
                   Delete
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>



<!-- ðŸ” PAGINATION -->
<div class="pagination" style="
    display: flex;
    justify-content: flex-end;
    margin-top: 20px;
    gap: 6px;
">

    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}{% if limit %}&limit={{ limit }}{% endif %}"
           style="padding: 6px 10px; background:#edf2f7; border-radius:4px; text-decoration:none;">
            Previous
        </a>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
            <span style="
                padding: 6px 10px;
                background:#38a169;
                color:white;
                border-radius:4px;
                font-weight:bold;">
                {{ num }}
            </span>
        {% else %}
            <a href="?page={{ num }}{% if query %}&q={{ query }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}{% if limit %}&limit={{ limit }}{% endif %}"
               style="padding: 6px 10px; background:#edf2f7; border-radius:4px; text-decoration:none;">
                {{ num }}
            </a>
        {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}{% if limit %}&limit={{ limit }}{% endif %}"
           style="padding: 6px 10px; background:#edf2f7; border-radius:4px; text-decoration:none;">
            Next
        </a>
    {% endif %}

</div>



<script>
    setTimeout(function () {
        const msg = document.getElementById('flash-message');
        if (msg) {
            msg.style.opacity = '0';
            setTimeout(() => msg.remove(), 1000);
        }
    }, 3000);
</script>

<script>
function printTable() {
    const printContent = document.getElementById("print-area").innerHTML;
    const originalContent = document.body.innerHTML;

    document.body.innerHTML = `
        <html>
        <head>
            <title>Student Records</title>
            <style>
                table {
                    width: 100%;
                    border-collapse: collapse;
                }
                th, td {
                    border: 1px solid #000;
                    padding: 6px;
                    text-align: left;
                }
                th {
                    background-color: #f0f0f0;
                }
            </style>
        </head>
        <body>
            <h2 style="text-align:center;">Student Records</h2>
            ${printContent}
        </body>
        </html>
    `;

    window.print();
    document.body.innerHTML = originalContent;
    location.reload();
}
</script>


{% endblock %}

